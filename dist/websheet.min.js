function websheet(e,t){const a=Object.keys(window._websheet.handlers).length;function n(t){throw new Error(`[websheet:${e}] ${t}`)}window._websheet.handlers[`dataset${a}`]={},t.url&&t.sheet||n("Missing url or sheet");const s=/^https:\/\/docs\.google\.com\/spreadsheets\/d\/([^/]*)\//g.exec(t.url);s||n("Invalid spreadsheet url"),!1!==t.caching&&(t.caching=!0);const o=document.querySelectorAll("[data-websheet-template]");for(const e of o){const t=e.dataset.websheetTemplate;window._websheet.templates[t]=e}const l=document.querySelectorAll("[data-websheet-render]");for(const e of l){const t=e.dataset.websheetRender;window._websheet.templates[t]||n(`Template '${t}' not found`),e.innerHTML=window._websheet.templates[t].innerHTML}const r=t.query?t.query.trim():"select *",d=document.querySelectorAll(`[data-websheet="${e}"]`),c={tqx:"out:json;responseHandler:window._websheet.handlers.dataset"+a,sheet:t.sheet,headers:1,tq:r};let h=null,i=[];const u=Object.keys(c).map(e=>`${e}=${encodeURIComponent(c[e])}`),w=`https://docs.google.com/spreadsheets/d/${s[1]}/gviz/tq?${u.join("&")}`;if(window._websheet.handlers[`dataset${a}`]=((e,a=!1)=>{"error"===e.status&&n(e.errors.map(e=>e.detailed_message).join(", "));const s=e.table.rows.map(a=>{const n={};for(const t in e.table.cols){const s=e.table.cols[t];if(""===s.label)continue;let o=a.c[t]&&a.c[t].v||null;!o||"date"!==s.type&&"datetime"!==s.type||(o=eval(`new ${o}`)),n[s.label]={type:s.type,value:o,formatted:a.c[t]&&a.c[t].f||null}}if(t.aliases)for(const e of Object.keys(t.aliases)){const a=t.aliases[e](n);n[e]={type:typeof a,value:a,formatted:null}}return n});if(t.onLoaded&&!a&&t.onLoaded(s),t.caching)if(a)h=e.sig;else{if(e.sig===h)return;localStorage.setItem(`websheet:${w}`,JSON.stringify(e)),i.map(e=>e.el.innerHTML=e.html)}a&&(i=[]);for(const e of d)a&&i.push({el:e,html:e.innerHTML}),b(t,e,s)}),t.caching&&(json=localStorage.getItem(`websheet:${w}`))){let e;try{e=JSON.parse(json)}catch(t){e=null}e&&window._websheet.handlers[`dataset${a}`](e,!0)}function b(e,t,a){const s=[{tag:"text",valueSource:"column",handler:(e,t,a)=>{a&&(e.innerText=a.formatted||a.value)}},{tag:"html",valueSource:"column",handler:(e,t,a)=>{a&&(e.innerHTML=a.value)}},{tag:"if",valueSource:"column",handler:(e,t,a)=>{a&&a.value||e.remove()}},{tag:"unless",valueSource:"column",handler:(e,t,a)=>{a&&a.value&&e.remove()}},{tag:/^data-websheet-bind:(.*)$/,valueSource:"column",handler:(e,t,a)=>{const n=t.match(/^data-websheet-bind:(.*)$/)[1];a&&e.setAttribute(n,a.formatted||a.value)}}];let o=t.cloneNode(!0);t.innerHTML="";for(const e of a){const a=o.cloneNode(!0);for(const t of s){let s;s=t.tag instanceof RegExp?m(a,t.tag):a.querySelectorAll(`[data-websheet-${t.tag}]`);for(const a of s){let s;s=t.tag instanceof RegExp?a.getAttributeNames().filter(e=>e.match(t.tag)):[`data-websheet-${t.tag}`];for(const o of s){const s="websheet"+o.substr(14).split("-").map(e=>`${e[0].toUpperCase()}${e.substr(1)}`).join(""),l=a.dataset[s].trim();"column"===t.valueSource?e[l]?t.handler(a,o,e[l]):n(`Column or alias '${l}' not found (used in data-websheet-${t.tag})`):t.handler(a,o,l)}}}t.appendChild(a),a.className=`${a.className} websheet--loaded`}}function m(e,t){return Array.prototype.slice.call(e.querySelectorAll("*")).filter(function(e){for(const a of e.getAttributeNames())if(a.match(t))return!0;return!1})}fetch(w).then(e=>e.text()).then(e=>eval(e))}window._websheet={handlers:{},templates:{}},document.head.insertAdjacentHTML("beforeend","<style>\n\n.websheet--loaded[data-websheet] [data-websheet-on\\:loaded] {\n    display: block;\n}\n\n[data-websheet-template],\n[data-websheet] [data-websheet-on\\:loaded],\n.websheet--loaded[data-websheet] [data-websheet-on\\:loading] {\n    display: none;\n}\n\n</style>");